# План реализации ChatList

## Этап 1: Подготовка проекта

1.1. Создать структуру каталогов проекта
1.2. Обновить `requirements.txt` с необходимыми зависимостями (PyQt5, httpx, python-dotenv)
1.3. Создать файл `.env.example` с примером переменных окружения для API-ключей
1.4. Создать файл `.gitignore`

## Этап 2: База данных (db.py)

2.1. Создать модуль `db.py` с классом `Database`
2.2. Реализовать инициализацию SQLite и создание таблиц:
   - `prompts` — хранение промптов
   - `models` — список нейросетей
   - `results` — сохранённые результаты
   - `settings` — настройки программы
2.3. Реализовать CRUD-операции для каждой таблицы:
   - `add_prompt()`, `get_prompts()`, `delete_prompt()`
   - `add_model()`, `get_models()`, `update_model()`, `delete_model()`
   - `save_results()`, `get_results()`, `delete_result()`
   - `get_setting()`, `set_setting()`
2.4. Добавить методы поиска и фильтрации

## Этап 3: Работа с API нейросетей (network.py)

3.1. Создать модуль `network.py`
3.2. Реализовать базовый класс `APIClient` для отправки запросов
3.3. Реализовать адаптеры для разных провайдеров:
   - OpenAI-совместимый API (OpenAI, DeepSeek, Groq, Together)
   - Claude (Anthropic)
   - Google Gemini
3.4. Реализовать асинхронную отправку запросов (httpx + asyncio)
3.5. Добавить обработку ошибок и таймаутов
3.6. Реализовать загрузку API-ключей из `.env`

## Этап 4: Логика работы с моделями (models.py)

4.1. Создать модуль `models.py`
4.2. Реализовать класс `ModelManager`:
   - Получение списка активных моделей
   - Валидация настроек модели
   - Проверка доступности API
4.3. Реализовать временное хранилище результатов в памяти

## Этап 5: Графический интерфейс (main.py)

5.1. Создать главное окно приложения с вкладками:
   - Вкладка «Запрос» — ввод и отправка промпта
   - Вкладка «Результаты» — таблица ответов
   - Вкладка «Модели» — управление нейросетями
   - Вкладка «История» — сохранённые результаты
   - Вкладка «Настройки»

5.2. Вкладка «Запрос»:
   - Текстовое поле для ввода промпта
   - Выпадающий список сохранённых промптов
   - Кнопка «Отправить»
   - Индикатор загрузки

5.3. Вкладка «Результаты»:
   - Таблица с колонками: чекбокс, модель, ответ
   - Кнопка «Сохранить выбранные»
   - Кнопка «Очистить»

5.4. Вкладка «Модели»:
   - Таблица моделей с возможностью редактирования
   - Кнопки добавления/удаления моделей
   - Переключатель активности модели

5.5. Вкладка «История»:
   - Таблица сохранённых результатов
   - Поиск и фильтрация по дате/модели/тегам
   - Кнопки экспорта и удаления

5.6. Вкладка «Настройки»:
   - Настройки таймаутов
   - Путь к файлу `.env`

## Этап 6: Интеграция компонентов

6.1. Связать GUI с модулем `db.py`
6.2. Связать GUI с модулем `network.py`
6.3. Реализовать многопоточность для неблокирующих запросов (QThread)
6.4. Добавить обработку ошибок и уведомления пользователю

## Этап 7: Дополнительные функции

7.1. Реализовать экспорт в Markdown
7.2. Реализовать экспорт в JSON
7.3. Добавить логирование запросов
7.4. Добавить сортировку во все таблицы

## Этап 8: AI-ассистент для улучшения промптов

8.1. Создать системный промпт для AI-ассистента:
   - Инструкции для улучшения пользовательских промптов
   - Формат вывода: улучшенная версия + 2-3 альтернативы
   - Адаптация под типы задач (код, анализ, креатив)

8.2. Реализовать класс `PromptImprover` в `models.py`:
   - Метод `improve_prompt(original_prompt, model_id)` → возвращает структуру с вариантами
   - Использование существующего `OpenRouterClient` из `network.py`
   - Парсинг ответа AI в структурированный формат

8.3. Добавить настройку выбора модели для улучшения в `SettingsTab`:
   - Выпадающий список доступных моделей OpenRouter
   - Сохранение выбора в таблицу `settings`

8.4. Создать диалог `PromptImproverDialog` в `main.py`:
   - Отображение исходного промпта (только для чтения)
   - Отображение улучшенной версии
   - Список альтернативных вариантов (2-3 шт.)
   - Кнопки: «Использовать» для каждого варианта, «Закрыть»

8.5. Добавить кнопку «✨ Улучшить» на вкладку «Запрос»:
   - Расположение: рядом с кнопкой «Отправить»
   - Отключена, если поле ввода пустое
   - При нажатии открывает `PromptImproverDialog`

8.6. Реализовать асинхронную отправку через `QThread`:
   - Класс `ImproveWorker` для фонового запроса
   - Индикатор загрузки во время обработки
   - Обработка ошибок и таймаутов

8.7. Подстановка выбранного варианта:
   - По клику «Использовать» — текст вставляется в поле ввода промпта
   - Диалог закрывается автоматически
   - Пользователь может сразу отправить улучшенный промпт

## Этап 9: Расширенные настройки

9.1. Добавить выбор темы (светлая/тёмная):
   - Переключатель в `SettingsTab`
   - Применение стилей ко всему приложению
   - Сохранение в таблицу `settings`

9.2. Добавить настройку размера шрифта:
   - Ползунок или выпадающий список (12–20 пт)
   - Применение ко всем панелям
   - Сохранение в таблицу `settings`

9.3. Загрузка настроек при старте приложения

## Этап 10: Окно «О программе»

10.1. Создать диалог `AboutDialog`:
   - Название программы и версия
   - Краткое описание
   - Ссылка на репозиторий
   - Информация об авторе

10.2. Добавить пункт меню или кнопку для вызова диалога

## Этап 11: Тестирование и документация

11.1. Протестировать все функции
11.2. Исправить найденные ошибки
11.3. Обновить документацию

